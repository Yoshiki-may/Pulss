## 2025/12/09 Codex 作業議事録（岡本編集）

### 本日のゴール
- ダッシュボード/AI要件書を踏まえつつ、既存アーキテクチャを崩さずバックエンドを拡張し、P0領域の土台を用意する。
- フロント未配線部分のUXとエラー耐性を強化し、次フェーズのUI実装がスムーズに乗る状態にする。

### 実施内容（バックエンド）
- 永続化をインメモリ→SQLiteに置換（構造は維持）。`data.db` 自動生成。
- 新ドメイン/テーブル（P0足場）：Leads/ContactLogs, Proposals, Contracts, ClientBriefs, ContentPosts（投稿カレンダー）, MetricSnapshots（月次数値）, Notifications。既存 Client/Task/AI/Schedule/SNS News は非破壊拡張。
- 新サービス `ManagementService` を追加し、営業～制作～効果測定を統合。
- 新API（全て `/api`、CORS設定は既存のまま）:
  - リード: GET/POST/PUT `/leads`, GET/POST `/leads/{id}/contacts`
  - 提案: GET `/clients/{id}/proposals`, POST `/proposals`, PUT `/proposals/{id}`
  - 契約: GET `/clients/{id}/contracts`, POST `/contracts`
  - 引き継ぎブリーフ: GET/POST `/clients/{id}/brief`
  - コンテンツカレンダー: GET `/clients/{id}/content-posts`, POST `/content-posts`, PUT `/content-posts/{id}`
  - 月次メトリクス: GET `/clients/{id}/metrics`, POST `/metrics`
  - 通知: GET `/notifications?user=...`, POST `/notifications`, POST `/notifications/{id}/read`
- 既存機能（クライアント/タスク/スケジュール/SNSニュース/AI提案）はロジック変更なし。`create_app` に新サービスを注入したのみ。
- 構文チェック: `python3 -m compileall backend` 実行でエラーなし（環境に python コマンド無しのため python3 を使用）。

### 実施内容（フロント）
- 環境変数追加: `Code/Pulss-main/.env` に `VITE_API_BASE_URL=http://localhost:8000`。
- クライアント管理UX強化: ステータス切替でタブ同期、選択時のタブ追随、ローディング時エラーメッセージ表示。
- Sidebar: 親管理のステータスタブと同期。
- Task/Schedule: CRUD時のエラーハンドリングを追加し、ユーザー通知。
- SNSニュース: カード全体クリックでリンク遷移、リンクなしでも安全表示。
- チームボード: 取得失敗時のエラー表示とフォールバック明示。
- 新APIへのフロント配線（リード/提案/契約/投稿カレンダー/メトリクス/通知）は未着手（次フェーズ）。

### 躓きと対応
- `python` 不在 → `python3` でコンパイルチェック。
- `create_app` への新サービス注入漏れを検知・修正（router引数も修正）。

### 残タスク / リスク
- フロント配線未完：リード/提案/契約/コンテンツ/メトリクス/通知のUIとサービス実装が必要。
- AI要件の `/api/ai/*` スタブ未実装（宿題ボット/背景レポート/提案骨子/議事録/効果レポート）。
- バリデーション/権限制御は簡易。将来JWTやRBAC導入を検討。
- マイグレーションツール未導入（現状はテーブル自動生成）。
- ダッシュボード集計APIは未実装。UI側は拡張前提でエラーハンドリングのみ。

### 確認事項
- 既存CORS/ポート設定はそのまま。`uvicorn main:app --reload` で起動可。
- 初期シードは空DB時のみ（クライアント/タスク）。新テーブルにシードなし。
- 新APIはスキーマ足場。数値集計・AI処理はモック前提。フロント接続時は空データ想定でUIを組む。

### 参考
- Codex会話ログ: `docs/60_DevNotes_開発メモ/CodexOutPut/会話ログ/20251209 1650 岡本codex 会話ログ.md`

### 次アクション（推奨順）
1. フロントサービス/タブ配線（リード・提案/契約・投稿カレンダー・メトリクス・通知）。最小CRUD UIを追加。
2. AIスタブAPIを追加し、AIタブを拡張（モデル層はモックで可）。
3. 簡易E2E確認（リード→提案→契約→コンテンツ→メトリクス→通知のCRUD、スケジュール/タスクの保存、ニュースリンク遷移）。
4. バリデーション/権限制御の足場整備、必要ならマイグレーション導入。
