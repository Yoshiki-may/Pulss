# 解決プラン（優先度順）

## 0. 前提整備
- 全ファイルの文字コードを UTF-8 に統一し、文字化けしている文言を復元。VS Code なら「UTF-8 (BOMなし)」で再保存。
- `.env` を導入し、API ベース URL / OpenAI API Key / CORS 許可ドメインを環境変数管理にする。

## 1. OpenAI / n8n 側の安定化
- OpenAI Platform に課金設定を行い、レート制限を緩和。予算上限・日次制限を Console でセット。
- n8n の OpenAI ノードでモデル・トークン上限・リトライ設定を明示し、429 時のバックオフを追加。

## 2. FastAPI バックエンドの最小実装
- エンドポイント: `GET /api/health`（疎通用）、`POST /api/sns-news`（n8n からのニュース保存）、`GET /api/sns-news?platform&industry&limit`（フロント向け取得）を先に用意。
- モデル/スキーマ定義（Pydantic）: `SnsNewsItem` with id/title/summary/url/platform_tags/industry_tags/source/published_at/fetched_at。
- 永続化: まずは SQLite で良いので Alembic でマイグレーションを作成し、後で RDS へ差し替えやすい形にする。
- CORS: `http://<EC2 IP>:5173` と将来のドメインを許可。ローカル開発用 `http://localhost:5173` も追加。

## 3. フロントエンド修復と API 接続
- 文字化け文言をすべて日本語に再入力し、UI を読める状態へ戻す（`App.tsx`, `components/**`, `services/clientService.ts`）。
- `clientService` をモックから API 呼び出しに差し替え（`fetch`/`axios`）。環境変数で API ベース URL を切り替える。
- `/api/sns-news` の一覧取得を `SnsNewsPage` / `SnsNewsWidget` に接続。空結果時のプレースホルダとエラー表示を整える。
- Tailwind を CDN ではなく PostCSS ビルドに切り替え（`tailwindcss` + `postcss` + `autoprefixer`）、不要な importmap を削除してバンドルを一元化。

## 4. デプロイ整備（Amazon Linux 2023）
- FastAPI: `uvicorn` を `systemd` サービス化、ポート 8000 → Nginx リバースプロキシ経由で 80/443 公開。
- フロント: `npm run build` した `dist` を Nginx の `root` に配置。`try_files` で SPA ルーティングを有効化。
- n8n: `.env` で `N8N_SECURE_COOKIE=false`（開発中）、本番は HTTPS + 正式ドメインを取得し secure cookie を有効化。

## 5. テストと運用
- バックエンド: `pytest` + `httpx` で API の単体/疎通テストを追加。ニュース保存・フィルタリングの回帰テストを用意。
- フロント: `npm run build` を CI で回し、最低限の `vitest`/`@testing-library/react` でコンポーネント描画テストを追加。
- 監視: Nginx アクセスログ、uvicorn ログ、n8n 実行ログを `journalctl` か CloudWatch Logs に集約。429/5xx を検出したら通知。
